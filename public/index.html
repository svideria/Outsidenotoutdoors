<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Workout Tracker</title>
  <style>
    /* PDF Modal Styles */
    #pdfModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 1000;
    }

    #pdfModal iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    /* Button Row Styles */
    .button-row {
      display: flex;
      flex-direction: column;
      gap: 10px;
      align-items: center;
    }

    @media (min-width: 600px) {
      .button-row {
        flex-direction: row;
        justify-content: center;
      }
    }

    .button-row button {
      width: 90%;
      max-width: 300px;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      background-color: #f2f5f9;
      color: #2e2e2e;
      margin: 0;
      padding: 2rem;
      line-height: 1.6;
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      color: #222;
    }

    h2 {
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 0.5rem;
      margin-top: 2rem;
      font-size: 1.4rem;
      color: #444;
    }

    .day-section {
      background: #ffffff;
      border: 1px solid #e6e9ef;
      border-radius: 10px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .exercise {
      margin-bottom: 2rem;
    }

    input[type="number"],
    input[type="text"] {
      display: block;
      width: 100%;
      max-width: 400px;
      margin-top: 0.3rem;
      margin-bottom: 1rem;
      padding: 0.75rem;
      font-size: 1rem;
      border: 1px solid #ccd0d5;
      border-radius: 6px;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
    }

    select {
      padding: 0.5rem;
      border: 1px solid #ccd0d5;
      border-radius: 6px;
      font-size: 1rem;
    }

    button {
      background-color: #007bff;
      color: white;
      padding: 10px 20px;
      margin-top: 0.5rem;
      margin-right: 0.5rem;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
      min-width: 150px;
      text-align: center;
    }

    button:hover {
      background-color: #0056b3;
    }

    button[type="button"][style*="background-color: #dc3545"] {
      background-color: #dc3545;
    }

    button[type="button"][style*="background-color: #dc3545"]:hover {
      background-color: #a71d2a;
    }

    .set-table {
      width: 100%;
      max-width: 500px;
      margin-top: 1rem;
      margin-bottom: 1.5rem;
      border-collapse: collapse;
    }

    .set-table th,
    .set-table td {
      padding: 0.5rem;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    .set-table input[type="number"] {
      width: 80px;
    }

    /* Remove number input spinners */
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type=number] {
      -moz-appearance: textfield;
    }

    /* Increase the size of checkboxes */
    input[type="checkbox"] {
      width: 20px;
      height: 20px;
    }
    /* Color checked checkboxes green */
    input[type="checkbox"]:checked {
      accent-color: #28a745;
    }

    .autofill-suggest {
      color: #888;
      font-style: italic;
    }

    .autofill-confirm,
    .autofill-cancel {
      margin-top: 1rem;
      margin-right: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .autofill-confirm {
      background-color: #28a745;
      color: white;
    }

    .autofill-cancel {
      background-color: #dc3545;
      color: white;
    }

    .toggle-notes-btn {
      margin-top: 0.5rem;
      padding: 10px 20px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
      min-width: 150px;
      text-align: center;
    }

    .exercise-notes {
      width: 100%;
      max-width: 500px;
      height: 60px;
      margin-top: 0.5rem;
      font-size: 1rem;
      padding: 0.5rem;
    }

    /* Mobile-friendly styles */
    @media (max-width: 600px) {
      body {
        padding: 1rem;
      }

      .day-section {
        padding: 1rem;
      }

      .set-table {
        font-size: 0.9rem;
      }

      .set-table th,
      .set-table td {
        padding: 0.25rem;
      }

      input[type="number"],
      input[type="text"],
      select,
      textarea {
        width: 100%;
        font-size: 1rem;
      }

      button {
        width: 100%;
        margin: 0.5rem 0;
        font-size: 1rem;
      }

      .autofill-confirm,
      .autofill-cancel {
        width: 100%;
        margin-bottom: 0.5rem;
      }

      .toggle-notes-btn {
        width: 100%;
      }

      #history-modal {
        width: 90%;
        left: 5%;
        transform: none;
        padding: 1rem;
      }

      canvas#history-chart {
        max-height: 200px;
      }

      #pdfModal iframe {
        width: 100vw !important;
        height: 100vh !important;
      }

      #pdfModal > div {
        width: 100vw !important;
        height: 100vh !important;
        margin: 0;
        padding: 0;
      }
    }
  </style>
</head>
<body>
  <h1>Workout Tracker</h1>
  <p id="current-date" style="text-align: center; font-size: 1rem; color: #555; margin-top: -1rem; margin-bottom: 2rem;"></p>
  <div class="button-row" style="margin-bottom: 1rem;">
    <button onclick="showLastWorkout()">View Last Workout</button>
    <button id="openPdfModal">View Workout Plan</button>
  </div>
  <p id="last-workout-display" style="font-size: 0.95rem; color: #333;"></p>
  <form id="workout-form">
    <div style="margin-bottom: 1rem;">
      <label for="day-select"><strong>Select Day:</strong></label>
      <select id="day-select" onchange="toggleDay()">
        <option value="day1">Day 1: Lower Body</option>
        <option value="day2">Day 2: Upper Body</option>
        <option value="day3">Day 3: Lower Body</option>
        <option value="day4">Day 4: Upper Body</option>
      </select>
    </div>

    <div class="day-section" id="day1">
      <h2>Day 1: Lower Body</h2>
      <div class="exercise">
        <p><strong>Barbell Back Squat</strong></p>
        <p><em>5 sets of 5 reps</em></p>
        <table class="set-table" data-exercise-name="Barbell Back Squat">
          <thead>
            <tr>
              <th>Set</th>
              <th>Weight (lbs)</th>
              <th>Reps</th>
              <th>✓</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><input type="number" name="squat1-set1-weight" placeholder="Weight" /></td>
              <td><input type="number" name="squat1-set1-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="squat1-set1-check" /></td>
            </tr>
            <tr>
              <td>2</td>
              <td><input type="number" name="squat1-set2-weight" placeholder="Weight" /></td>
              <td><input type="number" name="squat1-set2-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="squat1-set2-check" /></td>
            </tr>
            <tr>
              <td>3</td>
              <td><input type="number" name="squat1-set3-weight" placeholder="Weight" /></td>
              <td><input type="number" name="squat1-set3-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="squat1-set3-check" /></td>
            </tr>
            <tr>
              <td>4</td>
              <td><input type="number" name="squat1-set4-weight" placeholder="Weight" /></td>
              <td><input type="number" name="squat1-set4-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="squat1-set4-check" /></td>
            </tr>
            <tr>
              <td>5</td>
              <td><input type="number" name="squat1-set5-weight" placeholder="Weight" /></td>
              <td><input type="number" name="squat1-set5-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="squat1-set5-check" /></td>
            </tr>
          </tbody>
        </table>
        <button class="toggle-notes-btn" onclick="toggleNotes(this)">Add Notes</button>
        <textarea class="exercise-notes" style="display: none;" placeholder="Enter notes here..."></textarea>
        <button type="button" onclick="showExerciseHistory('Barbell Back Squat')">View History</button>
      </div>
      <div class="exercise">
        <p><strong>Romanian Deadlift</strong></p>
        <p><em>5 sets of 5 reps</em></p>
        <table class="set-table" data-exercise-name="Romanian Deadlift">
          <thead>
            <tr>
              <th>Set</th>
              <th>Weight (lbs)</th>
              <th>Reps</th>
              <th>✓</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><input type="number" name="rdl-set1-weight" placeholder="Weight" /></td>
              <td><input type="number" name="rdl-set1-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="rdl-set1-check" /></td>
            </tr>
            <tr>
              <td>2</td>
              <td><input type="number" name="rdl-set2-weight" placeholder="Weight" /></td>
              <td><input type="number" name="rdl-set2-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="rdl-set2-check" /></td>
            </tr>
            <tr>
              <td>3</td>
              <td><input type="number" name="rdl-set3-weight" placeholder="Weight" /></td>
              <td><input type="number" name="rdl-set3-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="rdl-set3-check" /></td>
            </tr>
            <tr>
              <td>4</td>
              <td><input type="number" name="rdl-set4-weight" placeholder="Weight" /></td>
              <td><input type="number" name="rdl-set4-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="rdl-set4-check" /></td>
            </tr>
            <tr>
              <td>5</td>
              <td><input type="number" name="rdl-set5-weight" placeholder="Weight" /></td>
              <td><input type="number" name="rdl-set5-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="rdl-set5-check" /></td>
            </tr>
          </tbody>
        </table>
        <button class="toggle-notes-btn" onclick="toggleNotes(this)">Add Notes</button>
        <textarea class="exercise-notes" style="display: none;" placeholder="Enter notes here..."></textarea>
        <button type="button" onclick="showExerciseHistory('Romanian Deadlift')">View History</button>
      </div>
    </div>

    <div class="day-section" id="day2">
      <h2>Day 2: Upper Body</h2>
      <div class="exercise">
        <p><strong>Barbell Bench Press</strong></p>
        <p><em>3 sets of 5 reps</em></p>
        <table class="set-table" data-exercise-name="Barbell Bench Press">
          <thead>
            <tr>
              <th>Set</th>
              <th>Weight (lbs)</th>
              <th>Reps</th>
              <th>✓</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><input type="number" name="bench-set1-weight" placeholder="Weight" /></td>
              <td><input type="number" name="bench-set1-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="bench-set1-check" /></td>
            </tr>
            <tr>
              <td>2</td>
              <td><input type="number" name="bench-set2-weight" placeholder="Weight" /></td>
              <td><input type="number" name="bench-set2-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="bench-set2-check" /></td>
            </tr>
            <tr>
              <td>3</td>
              <td><input type="number" name="bench-set3-weight" placeholder="Weight" /></td>
              <td><input type="number" name="bench-set3-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="bench-set3-check" /></td>
            </tr>
          </tbody>
        </table>
        <button class="toggle-notes-btn" onclick="toggleNotes(this)">Add Notes</button>
        <textarea class="exercise-notes" style="display: none;" placeholder="Enter notes here..."></textarea>
        <button type="button" onclick="showExerciseHistory('Barbell Bench Press')">View History</button>
      </div>
      <div class="exercise">
        <p><strong>Assisted Pull Up (Neutral Grip)</strong></p>
        <p><em>8 sets of 5 reps</em></p>
        <table class="set-table" data-exercise-name="Assisted Pull Up">
          <thead>
            <tr>
              <th>Set</th>
              <th>Weight (lbs)</th>
              <th>Reps</th>
              <th>✓</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><input type="number" name="pullup1-set1-weight" placeholder="Weight" /></td>
              <td><input type="number" name="pullup1-set1-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="pullup1-set1-check" /></td>
            </tr>
            <tr>
              <td>2</td>
              <td><input type="number" name="pullup1-set2-weight" placeholder="Weight" /></td>
              <td><input type="number" name="pullup1-set2-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="pullup1-set2-check" /></td>
            </tr>
            <tr>
              <td>3</td>
              <td><input type="number" name="pullup1-set3-weight" placeholder="Weight" /></td>
              <td><input type="number" name="pullup1-set3-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="pullup1-set3-check" /></td>
            </tr>
            <tr>
              <td>4</td>
              <td><input type="number" name="pullup1-set4-weight" placeholder="Weight" /></td>
              <td><input type="number" name="pullup1-set4-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="pullup1-set4-check" /></td>
            </tr>
            <tr>
              <td>5</td>
              <td><input type="number" name="pullup1-set5-weight" placeholder="Weight" /></td>
              <td><input type="number" name="pullup1-set5-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="pullup1-set5-check" /></td>
            </tr>
            <tr>
              <td>6</td>
              <td><input type="number" name="pullup1-set6-weight" placeholder="Weight" /></td>
              <td><input type="number" name="pullup1-set6-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="pullup1-set6-check" /></td>
            </tr>
            <tr>
              <td>7</td>
              <td><input type="number" name="pullup1-set7-weight" placeholder="Weight" /></td>
              <td><input type="number" name="pullup1-set7-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="pullup1-set7-check" /></td>
            </tr>
            <tr>
              <td>8</td>
              <td><input type="number" name="pullup1-set8-weight" placeholder="Weight" /></td>
              <td><input type="number" name="pullup1-set8-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="pullup1-set8-check" /></td>
            </tr>
          </tbody>
        </table>
        <button class="toggle-notes-btn" onclick="toggleNotes(this)">Add Notes</button>
        <textarea class="exercise-notes" style="display: none;" placeholder="Enter notes here..."></textarea>
        <button type="button" onclick="showExerciseHistory('Assisted Pull Up (Neutral Grip)')">View History</button>
      </div>
    </div>

    <div class="day-section" id="day3">
      <h2>Day 3: Lower Body</h2>
      <div class="exercise">
        <p><strong>Deadlift</strong></p>
        <p><em>3 sets of 5 reps</em></p>
        <table class="set-table" data-exercise-name="Deadlift">
          <thead>
            <tr>
              <th>Set</th>
              <th>Weight (lbs)</th>
              <th>Reps</th>
              <th>✓</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><input type="number" name="deadlift-set1-weight" placeholder="Weight" /></td>
              <td><input type="number" name="deadlift-set1-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="deadlift-set1-check" /></td>
            </tr>
            <tr>
              <td>2</td>
              <td><input type="number" name="deadlift-set2-weight" placeholder="Weight" /></td>
              <td><input type="number" name="deadlift-set2-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="deadlift-set2-check" /></td>
            </tr>
            <tr>
              <td>3</td>
              <td><input type="number" name="deadlift-set3-weight" placeholder="Weight" /></td>
              <td><input type="number" name="deadlift-set3-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="deadlift-set3-check" /></td>
            </tr>
          </tbody>
        </table>
        <button class="toggle-notes-btn" onclick="toggleNotes(this)">Add Notes</button>
        <textarea class="exercise-notes" style="display: none;" placeholder="Enter notes here..."></textarea>
        <button type="button" onclick="showExerciseHistory('Deadlift')">View History</button>
      </div>
      <div class="exercise">
        <p><strong>Barbell Back Squat</strong></p>
        <p><em>3 sets of 5 reps</em></p>
        <table class="set-table" data-exercise-name="Barbell Back Squat">
          <thead>
            <tr>
              <th>Set</th>
              <th>Weight (lbs)</th>
              <th>Reps</th>
              <th>✓</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><input type="number" name="squat2-set1-weight" placeholder="Weight" /></td>
              <td><input type="number" name="squat2-set1-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="squat2-set1-check" /></td>
            </tr>
            <tr>
              <td>2</td>
              <td><input type="number" name="squat2-set2-weight" placeholder="Weight" /></td>
              <td><input type="number" name="squat2-set2-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="squat2-set2-check" /></td>
            </tr>
            <tr>
              <td>3</td>
              <td><input type="number" name="squat2-set3-weight" placeholder="Weight" /></td>
              <td><input type="number" name="squat2-set3-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="squat2-set3-check" /></td>
            </tr>
          </tbody>
        </table>
        <button class="toggle-notes-btn" onclick="toggleNotes(this)">Add Notes</button>
        <textarea class="exercise-notes" style="display: none;" placeholder="Enter notes here..."></textarea>
        <button type="button" onclick="showExerciseHistory('Barbell Back Squat')">View History</button>
      </div>
      <div class="exercise">
        <p><strong>Lunge</strong></p>
        <p><em>3 sets of 8–10 reps</em></p>
        <table class="set-table" data-exercise-name="Lunge">
          <thead>
            <tr>
              <th>Set</th>
              <th>Weight (lbs)</th>
              <th>Reps</th>
              <th>✓</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><input type="number" name="lunge-set1-weight" placeholder="Weight" /></td>
              <td><input type="number" name="lunge-set1-reps" placeholder="Reps" value="8" /></td>
              <td><input type="checkbox" name="lunge-set1-check" /></td>
            </tr>
            <tr>
              <td>2</td>
              <td><input type="number" name="lunge-set2-weight" placeholder="Weight" /></td>
              <td><input type="number" name="lunge-set2-reps" placeholder="Reps" value="8" /></td>
              <td><input type="checkbox" name="lunge-set2-check" /></td>
            </tr>
            <tr>
              <td>3</td>
              <td><input type="number" name="lunge-set3-weight" placeholder="Weight" /></td>
              <td><input type="number" name="lunge-set3-reps" placeholder="Reps" value="8" /></td>
              <td><input type="checkbox" name="lunge-set3-check" /></td>
            </tr>
          </tbody>
        </table>
        <button class="toggle-notes-btn" onclick="toggleNotes(this)">Add Notes</button>
        <textarea class="exercise-notes" style="display: none;" placeholder="Enter notes here..."></textarea>
        <button type="button" onclick="showExerciseHistory('Lunge')">View History</button>
      </div>
    </div>

    <div class="day-section" id="day4">
      <h2>Day 4: Upper Body</h2>
      <div class="exercise">
        <p><strong>Assisted Pull Up (Outer Grip)</strong></p>
        <p><em>5 sets of 5 reps</em></p>
        <table class="set-table" data-exercise-name="Assisted Pull Up (Outer Grip)">
          <thead>
            <tr>
              <th>Set</th>
              <th>Weight (lbs)</th>
              <th>Reps</th>
              <th>✓</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><input type="number" name="pullup2-set1-weight" placeholder="Weight" /></td>
              <td><input type="number" name="pullup2-set1-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="pullup2-set1-check" /></td>
            </tr>
            <tr>
              <td>2</td>
              <td><input type="number" name="pullup2-set2-weight" placeholder="Weight" /></td>
              <td><input type="number" name="pullup2-set2-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="pullup2-set2-check" /></td>
            </tr>
            <tr>
              <td>3</td>
              <td><input type="number" name="pullup2-set3-weight" placeholder="Weight" /></td>
              <td><input type="number" name="pullup2-set3-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="pullup2-set3-check" /></td>
            </tr>
            <tr>
              <td>4</td>
              <td><input type="number" name="pullup2-set4-weight" placeholder="Weight" /></td>
              <td><input type="number" name="pullup2-set4-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="pullup2-set4-check" /></td>
            </tr>
            <tr>
              <td>5</td>
              <td><input type="number" name="pullup2-set5-weight" placeholder="Weight" /></td>
              <td><input type="number" name="pullup2-set5-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="pullup2-set5-check" /></td>
            </tr>
          </tbody>
        </table>
        <button class="toggle-notes-btn" onclick="toggleNotes(this)">Add Notes</button>
        <textarea class="exercise-notes" style="display: none;" placeholder="Enter notes here..."></textarea>
        <button type="button" onclick="showExerciseHistory('Assisted Pull Up (Outer Grip)')">View History</button>
      </div>
      <div class="exercise">
        <p><strong>Barbell Overhead Press</strong></p>
        <p><em>5 sets of 5 reps</em></p>
        <table class="set-table" data-exercise-name="Barbell Overhead Press">
          <thead>
            <tr>
              <th>Set</th>
              <th>Weight (lbs)</th>
              <th>Reps</th>
              <th>✓</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td><input type="number" name="ohp-set1-weight" placeholder="Weight" /></td>
              <td><input type="number" name="ohp-set1-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="ohp-set1-check" /></td>
            </tr>
            <tr>
              <td>2</td>
              <td><input type="number" name="ohp-set2-weight" placeholder="Weight" /></td>
              <td><input type="number" name="ohp-set2-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="ohp-set2-check" /></td>
            </tr>
            <tr>
              <td>3</td>
              <td><input type="number" name="ohp-set3-weight" placeholder="Weight" /></td>
              <td><input type="number" name="ohp-set3-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="ohp-set3-check" /></td>
            </tr>
            <tr>
              <td>4</td>
              <td><input type="number" name="ohp-set4-weight" placeholder="Weight" /></td>
              <td><input type="number" name="ohp-set4-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="ohp-set4-check" /></td>
            </tr>
            <tr>
              <td>5</td>
              <td><input type="number" name="ohp-set5-weight" placeholder="Weight" /></td>
              <td><input type="number" name="ohp-set5-reps" placeholder="Reps" value="5" /></td>
              <td><input type="checkbox" name="ohp-set5-check" /></td>
            </tr>
          </tbody>
        </table>
        <button class="toggle-notes-btn" onclick="toggleNotes(this)">Add Notes</button>
        <textarea class="exercise-notes" style="display: none;" placeholder="Enter notes here..."></textarea>
        <button type="button" onclick="showExerciseHistory('Barbell Overhead Press')">View History</button>
      </div>
      <div style="margin-top: 2rem;">
        <button type="submit">Save Progress</button>
        <button type="button" onclick="resetForm()" style="margin-left: 10px; background-color: #dc3545; color: white;">Reset Notes</button>
      </div>
    </div>
  </form>

  <!-- Modal Structure -->
  <div id="pdfModal">
    <div style="margin: 0; padding: 0; background: white; width: 100vw; height: 100vh; position: relative;">
      <span id="closePdfModal" style="position: absolute; top: 10px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; z-index: 10;">&times;</span>
      <iframe id="pdfViewer" src="Elise%20Workout%20Plan.pdf"></iframe>
    </div>
  </div>

  <!-- Script for Modal -->
  <script>
    document.getElementById('openPdfModal').onclick = function() {
      document.getElementById('pdfModal').style.display = 'block';
    };
    document.getElementById('closePdfModal').onclick = function() {
      document.getElementById('pdfModal').style.display = 'none';
    };
    window.onclick = function(event) {
      if (event.target === document.getElementById('pdfModal')) {
        document.getElementById('pdfModal').style.display = 'none';
      }
    };
    // Ensure PDF modal is visible on page load
    // document.addEventListener('DOMContentLoaded', function() {
    //   document.getElementById('pdfModal').style.display = 'block';
    // });
  </script>

  <button onclick="saveToLocalStorage()" style="margin-top: 1rem; background-color: #007BFF; color: white; padding: 10px 20px; border: none; border-radius: 5px;">Complete Workout</button>
<script src="script.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  // Normalization function for exercise names
  function normalizeExerciseName(name) {
    const lower = name.toLowerCase();
    if (lower.includes("squat")) return "Barbell Back Squat";
    if (lower.includes("deadlift") && !lower.includes("romanian")) return "Deadlift";
    if (lower.includes("romanian")) return "Romanian Deadlift";
    if (lower.includes("bench")) return "Barbell Bench Press";
    if (lower.includes("pullup") || lower.includes("pull up")) return "Assisted Pull Up";
    if (lower.includes("overhead")) return "Barbell Overhead Press";
    if (lower.includes("lunge")) return "Lunge";
    return name;
  }
  // Helper to check if all sets of an exercise are filled and checked
  function isExerciseComplete(table) {
    const rows = table.querySelectorAll("tbody tr");
    return Array.from(rows).every(row => {
      const weight = row.cells[1].querySelector("input")?.value;
      const reps = row.cells[2].querySelector("input")?.value;
      const check = row.cells[3].querySelector("input[type='checkbox']")?.checked;
      return weight && reps && check;
    });
  }

  async function saveToLocalStorage() {
    const allInputs = document.querySelectorAll("input");
    allInputs.forEach(input => {
      const key = input.name;
      if (key) {
        localStorage.setItem(key, input.value);
      }
    });

    const textareas = document.querySelectorAll("textarea");
    const notesMap = {};
    textareas.forEach((area, idx) => {
      const exercise = area.closest('.exercise');
      const name = exercise.querySelector("strong").innerText;
      notesMap[name] = area.value.trim();
    });

    // Build exercise data map for PDF table
    const allRows = document.querySelectorAll("table tr");
    let exerciseDataMap = {};
    allRows.forEach(row => {
      const cells = row.querySelectorAll("td");
      if (cells.length >= 3) {
        const exercise = row.closest("table").getAttribute("data-exercise-name") || "Exercise";
        const set = cells[0].innerText.trim();
        const weight = cells[1].querySelector("input")?.value || "";
        const reps = cells[2].querySelector("input")?.value || "";
        if (weight && reps) {
          if (!exerciseDataMap[exercise]) exerciseDataMap[exercise] = [];
          exerciseDataMap[exercise].push({ set, weight, reps });
        }
      }
    });

    // ----- AUTO-FILL LOGIC FOR EXERCISE COMPLETION -----
    // If all sets of an exercise are filled and checked, auto-fill summary and trigger history save as if double-clicked
    document.querySelectorAll("table.set-table").forEach(table => {
      if (isExerciseComplete(table)) {
        const exercise = normalizeExerciseName(table.dataset.exerciseName);
        const sets = Array.from(table.querySelectorAll("tbody tr")).map(row => {
          const weight = row.cells[1].querySelector("input")?.value || "0";
          const reps = row.cells[2].querySelector("input")?.value || "0";
          return { weight, reps };
        });
        if (!exerciseDataMap[exercise]) exerciseDataMap[exercise] = [];
        exerciseDataMap[exercise].push(...sets);
      }
    });
    // ---------------------------------------------------

    // PDF export: use table format and notes below
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(16);

    const dayLabel = document.querySelector("#day-select").selectedOptions[0].textContent;
    const dateStr = new Date().toLocaleDateString(undefined, {
      weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
    });
    doc.text(`${dayLabel} - ${dateStr}`, 10, 10);
    doc.setFontSize(12);

    let startY = 20;
    doc.setFont(undefined, 'bold');
    doc.text("Exercise", 10, startY);
    doc.text("Sets", 60, startY);
    doc.text("Reps", 100, startY);
    doc.text("Weight (lbs)", 140, startY);
    doc.setFont(undefined, 'normal');

    startY += 10;

    Object.entries(exerciseDataMap).forEach(([exerciseRaw, sets]) => {
      const exercise = normalizeExerciseName(exerciseRaw);
      const setCount = sets.length;
      const repsList = sets.map(s => s.reps);
      const weightsList = sets.map(s => s.weight);

      const reps = repsList.every(r => r === repsList[0]) ? repsList[0] : repsList.join(", ");
      const weights = weightsList.every(w => w === weightsList[0]) ? weightsList[0] : weightsList.join(", ");

      doc.text(exercise, 10, startY);
      doc.text(`${setCount}`, 60, startY);
      doc.text(reps, 100, startY);
      doc.text(weights, 140, startY);

      startY += 10;
    });

    let notesY = startY + 10;
    for (const [exercise, note] of Object.entries(notesMap)) {
      if (note) {
        const wrapped = doc.splitTextToSize(`${exercise} Notes: ${note}`, 180);
        doc.text(wrapped, 10, notesY);
        notesY += wrapped.length * 8;
      }
    }

    // Save history entry
    const historyKey = 'eliseWorkoutHistory';
    const history = JSON.parse(localStorage.getItem(historyKey) || '{}');
    const today = new Date().toISOString().split("T")[0];
    if (!history[today]) history[today] = {};

    Object.entries(exerciseDataMap).forEach(([exerciseRaw, sets]) => {
      const exercise = normalizeExerciseName(exerciseRaw);
      const maxWeight = Math.max(...sets.map(s => parseFloat(s.weight) || 0));
      history[today][exercise] = {
        weight: Math.round(maxWeight),
        notes: notesMap[exercise] || ""
      };
    });

    localStorage.setItem(historyKey, JSON.stringify(history));

    // Instead of auto-downloading, create a Blob and a visible download link
    const pdfBlob = doc.output("blob");
    const pdfUrl = URL.createObjectURL(pdfBlob);

    // Create a visible download link
    let existingLink = document.getElementById("download-summary-link");
    if (!existingLink) {
      existingLink = document.createElement("a");
      existingLink.id = "download-summary-link";
      existingLink.textContent = "Download Workout Summary (PDF)";
      existingLink.style.display = "block";
      existingLink.style.marginTop = "1rem";
      existingLink.style.color = "#007bff";
      existingLink.style.textDecoration = "underline";
      document.body.appendChild(existingLink);
    }

    existingLink.href = pdfUrl;
    existingLink.download = `Workout_Summary_${new Date().toISOString().split("T")[0]}.pdf`;

    showToast("Workout Complete!");

    // Clear all inputs and notes
    allInputs.forEach(input => {
      if (input.type === "checkbox") {
        input.checked = false;
      } else {
        input.value = "";
      }
    });
    textareas.forEach(area => area.value = "");
  }
  // Toast notification function
  function showToast(message) {
    const toast = document.getElementById("toast");
    toast.textContent = message;
    toast.style.backgroundColor = "#28a745";
    toast.style.color = "white";
    toast.style.visibility = "visible";
    setTimeout(() => {
      toast.style.visibility = "hidden";
    }, 3000);
  }
  function resetForm() {
    const inputs = document.querySelectorAll('#workout-form input[type="text"]');
    inputs.forEach(input => input.value = '');
    localStorage.removeItem('eliseWorkoutLog');
    alert('Workout notes cleared.');
  }


  function showExerciseHistory(exerciseName) {
    const history = JSON.parse(localStorage.getItem('eliseWorkoutHistory') || '{}');
    const modal = document.getElementById('history-modal');
    const tableBody = document.querySelector('#history-table tbody');
    const modalTitle = document.getElementById('modal-title');

    // Always normalize for display
    modalTitle.textContent = `History for ${normalizeExerciseName(exerciseName)}`;
    tableBody.innerHTML = '';

    // Use normalized name for all comparisons and display
    const canonicalName = normalizeExerciseName(exerciseName).toLowerCase().replace(/\s+/g, '');
    for (const [date, data] of Object.entries(history)) {
      for (const [exName, entry] of Object.entries(data)) {
        const norm = normalizeExerciseName(exName).toLowerCase().replace(/\s+/g, '');
        if (canonicalName === norm) {
          const weight = entry.weight || '';
          if (weight) {
            const formattedDate = new Date(date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            const row = `<tr>
              <td style="padding: 0.5rem 0;">${formattedDate}</td>
              <td style="padding: 0.5rem 1rem;">${weight}</td>
            </tr>`;
            tableBody.innerHTML += row;
          }
        }
      }
    }

    modal.style.display = 'block';
  }

  function closeModal() {
    document.getElementById('history-modal').style.display = 'none';
  }

  
  function toggleNotes(button) {
    event.preventDefault(); // Prevent form submission or default button behavior
    const textarea = button.nextElementSibling;
    if (textarea.style.display === "none" || textarea.style.display === "") {
      textarea.style.display = "block";
      button.textContent = "Hide Notes";
    } else {
      textarea.style.display = "none";
      button.textContent = "Add Notes";
    }
  }

  // Set active day and store in localStorage
  function setActiveDay(dayId) {
    const allSections = document.querySelectorAll(".day-section");
    allSections.forEach(sec => sec.style.display = "none");
    document.getElementById(dayId).style.display = "block";
    // Update select dropdown to match
    const daySelect = document.getElementById('day-select');
    if (daySelect && daySelect.value !== dayId) {
      daySelect.value = dayId;
    }
    localStorage.setItem("activeDay", dayId);
  }

  // Old toggleDay now just calls setActiveDay
  function toggleDay() {
    const selected = document.getElementById('day-select').value;
    setActiveDay(selected);
  }
  document.addEventListener('DOMContentLoaded', () => {
    // Restore last active day from localStorage, else fallback to day1
    const savedDay = localStorage.getItem("activeDay");
    if (savedDay && document.getElementById(savedDay)) {
      setActiveDay(savedDay);
    } else {
      setActiveDay("day1");
    }
    // Add ArrowUp/ArrowDown stepper for all number inputs (+5/-5)
    document.querySelectorAll("input[type='number']").forEach(input => {
      input.addEventListener('keydown', e => {
        if (e.key === 'ArrowUp') {
          let v = parseFloat(input.value) || parseFloat(input.dataset.baseWeight) || 0;
          input.value = v + 5;
          input.setAttribute('data-base-weight', v + 5);
          e.preventDefault();
        } else if (e.key === 'ArrowDown') {
          let v = parseFloat(input.value) || parseFloat(input.dataset.baseWeight) || 0;
          const newVal = Math.max(0, v - 5);
          input.value = newVal;
          input.setAttribute('data-base-weight', newVal);
          e.preventDefault();
        }
      });
    });
    // Populate exercise filter dropdown
    const hist = JSON.parse(localStorage.getItem('eliseWorkoutHistory') || '{}');
    const allExercises = new Set();
    Object.values(hist).forEach(day => {
      Object.keys(day).forEach(ex => allExercises.add(ex));
    });
    const exFilter = document.getElementById('exercise-filter');
    if (exFilter) {
      allExercises.forEach(ex => {
        const opt = document.createElement("option");
        opt.value = ex;
        opt.textContent = ex;
        exFilter.appendChild(opt);
      });
    }
    // Restore double-click autofill functionality
    document.querySelectorAll("table.set-table").forEach(table => {
      const rows = table.querySelectorAll("tbody tr");
      rows.forEach((row, idx) => {
        const checkbox = row.querySelector("input[type='checkbox']");
        if (!checkbox) return;

        checkbox.addEventListener("dblclick", () => {
          if (idx !== 0) return; // Only allow double-click on first set
          const weight = row.cells[1].querySelector("input")?.value;
          const reps = row.cells[2].querySelector("input")?.value;
          if (!weight || !reps) return;

          rows.forEach((r, i) => {
            if (i === 0) return;
            const w = r.cells[1].querySelector("input");
            const rp = r.cells[2].querySelector("input");
            const chk = r.cells[3].querySelector("input[type='checkbox']");
            if (w && rp && chk) {
              w.value = weight;
              rp.value = reps;
              chk.checked = true;
            }
          });
        });
      });
    });
  });

  function updateDateTime() {
    const now = new Date();
    const dateString = now.toLocaleDateString(undefined, {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
    const timeString = now.toLocaleTimeString(undefined, {
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });
    document.getElementById("current-date").textContent = `${dateString} ${timeString}`;
  }

  document.addEventListener("DOMContentLoaded", () => {
    updateDateTime();
    setInterval(updateDateTime, 1000);
  });

  // Show last workout summary (refactored with day label inference)
  function showLastWorkout() {
    const history = JSON.parse(localStorage.getItem('eliseWorkoutHistory') || '{}');
    const lastDate = Object.keys(history).sort().reverse()[0];
    if (!lastDate || !history[lastDate]) {
      document.getElementById('last-workout-display').textContent = "No workout data found.";
      return;
    }

    // Try to infer the day label by checking what day section had data recorded
    const dayMapping = {
      "Day 1: Lower Body": ["Barbell Back Squat", "Romanian Deadlift"],
      "Day 2: Upper Body": ["Barbell Bench Press", "Assisted Pull Up"],
      "Day 3: Lower Body": ["Deadlift", "Lunge"],
      "Day 4: Upper Body": ["Barbell Overhead Press"]
    };

    const exercises = Object.keys(history[lastDate]);
    let matchedDay = "Unknown Day";
    for (const [label, exList] of Object.entries(dayMapping)) {
      if (exList.every(ex => exercises.includes(ex))) {
        matchedDay = label;
        break;
      }
    }

    const dateString = new Date(lastDate).toLocaleDateString(undefined, {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });

    document.getElementById('last-workout-display').textContent = `Last workout: ${matchedDay} on ${dateString}`;
  }
</script>

<!-- Modal for Viewing History -->
<div id="history-modal" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%); background:white; padding:2rem; border-radius:8px; box-shadow:0 2px 12px rgba(0,0,0,0.2); max-width:500px; z-index:1000;">
  <h3 id="modal-title">Exercise History</h3>
  <table id="history-table" style="width:100%; border-collapse: collapse;">
    <thead>
      <tr><th style="border-bottom: 1px solid #ccc; text-align:left; padding: 0.5rem 0;">Date</th><th style="border-bottom: 1px solid #ccc; text-align:left; padding: 0.5rem 0;">Weight (lbs)</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <canvas id="history-chart" style="margin-top:1rem; max-height: 250px;"></canvas>
  <button onclick="closeModal()" style="margin-top: 1rem;">Close</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
<div id="toast" style="visibility:hidden; min-width: 250px; margin-left: -125px; background-color: #28a745; color: white; text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 1; left: 50%; bottom: 30px; font-size: 17px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
  Workout saved!
</div>
</html>
